<!DOCTYPE html>
<head>
    <title>Simulator voznje</title>
    <style>
    .pedalo{
      border:1px solid black;
      width:4vw;
      height:20vh;
    }
    .volan
    {
      height:18vh;
      width:18vw;
    }
    </style>
</head>
<body>
  <center>
  <!--script src="Skripti/three.js"></script>
  <script src="Skripti/Igrca.js"></script-->
</center>
  <br />

  <canvas id="sklopka" class="pedalo"></canvas>
  <canvas id="bremza" class="pedalo"></canvas>
  <canvas id="plin" class="pedalo"></canvas>
  <canvas id="volan" class="volan"></canvas>
  <p id="stanje"></p>

  <script type="module">

  const socket = new WebSocket('ws://localhost:8080');
  let povezan=false;
  let plin=0;
  let sklopka=0;
  let bremza=0;
  let volan=0;

  let svolan = new Image();
  svolan.src= "Slike/volan.png";

  socket.onmessage=({data}) =>
  {
    let tmp = JSON.parse(data);
    plin=(tmp["plin"]);
    sklopka=(tmp["sklopka"]);
    bremza=(tmp["bremza"]);
    volan=(tmp["volan"]);
  }

  function izrisi(pedalo,vrednost)
  {
    let cp=document.getElementById(pedalo);
    let conp =cp.getContext('2d');
    conp.clearRect(0, 0, cp.width, cp.height);
    conp.fillStyle = "#00CC00";
    conp.fillRect(0,cp.height-vrednost*cp.height,cp.width,vrednost*cp.height);
  }

  function izrisivolan(volan)
  {
    let cp=document.getElementById("volan");
    let conp =cp.getContext('2d');
    let razmerje = Math.min(cp.width / svolan.width, cp.height / svolan.height);
    conp.clearRect(0, 0, cp.width, cp.height);
    conp.rotate(volan * Math.PI / 180);
    conp.drawImage(svolan, 0, 0,svolan.width*razmerje,svolan.height*razmerje);
  }

  function pstanje()
  {
    let stanje = document.getElementById("stanje");
    if(socket.readystate==1)
      {
        stanje.innerHTML="Povezava vzpostavljena!";
        return 1;
      }
    else if(socket.readystate==0)
      stanje.innerHTML="Vzpostavljanje povezave!";
    else if(socket.readystate==0)
      stanje.innerHTML="Prekinjanje povezave!";
    else
      stanje.innerHTML="Povezava ni vzpostavljena!";
    return 0;
          }
  setInterval(()=>{
      if(pstanje())
        socket.send("podatki");

      izrisi("plin",plin);
      izrisi("bremza",bremza);
      izrisi("sklopka",sklopka)
      izrisivolan(volan);
    },20
  );
  </script>
</body>
</html>
